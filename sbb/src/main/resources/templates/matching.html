<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>Moata-매칭</title>
	    <script src="https://cdn.tailwindcss.com"></script>
	    <link rel="stylesheet" href="/css/global.css">
	</head>
	<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50">
	    <!-- Background decorations -->
	    <div class="fixed inset-0 overflow-hidden pointer-events-none">
	        <div class="absolute -top-40 -right-40 w-80 h-80 bg-blue-200/30 rounded-full blur-3xl"></div>
	        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-200/30 rounded-full blur-3xl"></div>
	    </div>

	    <div class="container mx-auto px-4 py-8 relative z-10">
	        <div class="max-w-4xl mx-auto">
	            <!-- Search Form -->
	            <div class="mb-8 shadow-lg border-0 bg-white/80 backdrop-blur-sm rounded-lg p-6">
	                <h2 class="text-2xl font-semibold mb-6 flex items-center gap-2">
	                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                        <circle cx="11" cy="11" r="8"></circle>
	                        <path d="m21 21-4.35-4.35"></path>
	                    </svg>
	                    택시 메이트 찾기
	                </h2>
	                <form id="searchForm" class="space-y-6">
	                    <!-- 위치 상태 표시 추가 -->
	                    <div id="locationStatus" class="text-sm font-medium text-gray-600 flex items-center gap-2 border-l-4 border-gray-400 pl-3 py-1">
	                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
	                            <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
	                        </svg>
	                        <span class="truncate">내 위치 상태: 검색 시 현재 위치 요청</span>
	                    </div>

	                    <div class="grid md:grid-cols-2 gap-4">
	                        <!-- GPS 버튼 제거하고 기본 입력란으로 변경 -->
	                        <div>
	                            <label class="text-sm font-medium block mb-2">출발지</label>
	                            <div class="relative">
	                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 top-3 text-gray-400">
	                                    <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
	                                    <circle cx="12" cy="10" r="3"></circle>
	                                </svg>
	                                <input id="departure" type="text" placeholder="출발지를 입력하세요" 
	                                       class="w-full px-3 py-2 border rounded-lg pl-10">
	                            </div>
	                        </div>
	                        <div>
	                            <label class="text-sm font-medium block mb-2">목적지</label>
	                            <div class="relative">
	                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 top-3 text-gray-400">
	                                    <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
	                                    <circle cx="12" cy="10" r="3"></circle>
	                                </svg>
	                                <input id="destination" type="text" placeholder="목적지를 입력하세요" 
	                                       class="w-full px-3 py-2 border rounded-lg pl-10">
	                            </div>
	                        </div>
	                    </div>
	                    <div>
	                        <label class="text-sm font-medium block mb-2">출발 시간</label>
	                        <div class="relative max-w-xs">
	                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 top-3 text-gray-400">
	                                <circle cx="12" cy="12" r="10"></circle>
	                                <polyline points="12 6 12 12 16 14"></polyline>
	                            </svg>
	                            <input id="departureTime" type="datetime-local" class="w-full px-3 py-2 border rounded-lg pl-10">
	                        </div>
	                    </div>
	                    <!-- 버튼에 disabled 상태 추가 -->
	                    <button type="submit" id="searchButton"
	                            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 text-lg rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
	                        택시 메이트 찾기
	                    </button>
	                </form>
	            </div>

	            <!-- Results -->
	            <div id="results" class="hidden space-y-6">
	                <div class="flex items-center justify-between">
	                    <h2 class="text-2xl font-bold text-gray-900">매칭 결과 (1명)</h2>
	                    <span class="text-sm bg-gray-100 px-3 py-1 rounded-full">실시간 업데이트</span>
	                </div>

	                <!-- Match Cards -->
	                <div class="space-y-4">
	                    <div class="bg-white/80 backdrop-blur-sm rounded-lg p-6 hover:shadow-lg transition">
	                        <div class="flex items-start justify-between">
	                            <div class="flex items-start gap-4 flex-1">
	                                <div class="relative">
	                                    <div class="w-12 h-12 bg-blue-500 rounded-full"></div>
	                                    <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
	                                </div>
	                                <div class="flex-1 space-y-3">
	                                    <div class="flex items-center gap-3">
	                                        <h3 class="font-semibold text-lg">김민수</h3>
	                                        <span class="bg-green-500 text-white text-xs px-2 py-1 rounded">95% 매칭</span>
	                                        <span class="border border-green-600 text-green-600 text-xs px-2 py-1 rounded">온라인</span>
	                                    </div>
	                                    <div class="grid md:grid-cols-2 gap-3 text-sm text-gray-600">
	                                        <div>출발: 강남역 2번 출구</div>
	                                        <div>도착: 인천공항 1터미널</div>
	                                        <div>출발시간: 14:30</div>
	                                        <div>거리: 0.2km</div>
	                                    </div>
	                                </div>
	                            </div>
	                            <div class="flex flex-col gap-2 ml-4">
	                                <a href="/chat">
	                                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
	                                        채팅하기
	                                    </button>
	                                </a>
	                                <button class="border px-4 py-2 rounded-lg text-sm">매칭 요청</button>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>

	    <!-- JavaScript 추가 및 검색 기능 구현 -->
	    <script src="/js/app.js"></script>
	    <script>
	        // State
	        let userLocation = null;
	        let isSearching = false;

	        // DOM elements
	        const searchForm = document.getElementById('searchForm');
	        const departureInput = document.getElementById('departure');
	        const destinationInput = document.getElementById('destination');
	        const departureTimeInput = document.getElementById('departureTime');
	        const searchButton = document.getElementById('searchButton');
	        const locationStatus = document.getElementById('locationStatus');
	        const resultsDiv = document.getElementById('results');

	        // Update location status UI
	        function updateLocationStatus(message, status = 'default') {
	            const statusDiv = locationStatus.querySelector('span');
	            statusDiv.textContent = `내 위치 상태: ${message}`;
	            
	            const borderColors = {
	                'error': 'border-red-500',
	                'success': 'border-green-500',
	                'default': 'border-gray-400'
	            };
	            
	            locationStatus.className = 'text-sm font-medium text-gray-600 flex items-center gap-2 border-l-4 pl-3 py-1 ' + borderColors[status];
	        }

	        // Get user location
	        function getUserLocation() {
	            return new Promise((resolve, reject) => {
	                updateLocationStatus('현재 위치 가져오는 중...', 'default');
	                
	                if (navigator.geolocation) {
	                    navigator.geolocation.getCurrentPosition(
	                        (position) => {
	                            const location = {
	                                lat: position.coords.latitude,
	                                lng: position.coords.longitude,
	                            };
	                            userLocation = location;
	                            updateLocationStatus(`위치 획득 (${location.lat.toFixed(4)}, ${location.lng.toFixed(4)})`, 'success');
	                            resolve(location);
	                        },
	                        (error) => {
	                            updateLocationStatus('위치 정보 획득 실패 (권한 거부 또는 오류)', 'error');
	                            console.error('[v0] Geolocation Error:', error);
	                            reject(new Error('위치 정보 획득 실패'));
	                        },
	                        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
	                    );
	                } else {
	                    updateLocationStatus('이 브라우저에서는 Geolocation이 지원되지 않습니다.', 'error');
	                    reject(new Error('Geolocation 미지원'));
	                }
	            });
	        }

	        // Handle search
	        async function handleSearch(e) {
	            e.preventDefault();

	            const departure = departureInput.value;
	            const destination = destinationInput.value;
	            const departureTime = departureTimeInput.value;

	            if (!departure || !destination || !departureTime) {
	                alert('모든 필드를 입력해주세요.');
	                return;
	            }

	            isSearching = true;
	            searchButton.disabled = true;
	            searchButton.innerHTML = `
	                <div class="flex items-center justify-center gap-2">
	                    <div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
	                    위치 확인 및 매칭 중...
	                </div>
	            `;

	            // Get user location
	            try {
	                await getUserLocation();
	            } catch (error) {
	                isSearching = false;
	                searchButton.disabled = false;
	                searchButton.textContent = '택시 메이트 찾기';
	                updateLocationStatus('위치 정보 없이는 검색을 완료할 수 없습니다.', 'error');
	                alert('위치 정보를 가져올 수 없습니다. 위치 권한을 허용해주세요.');
	                return;
	            }

	            // Simulate API call with location
	            setTimeout(() => {
	                isSearching = false;
	                searchButton.disabled = false;
	                searchButton.textContent = '택시 메이트 찾기';

	                // Show results
	                resultsDiv.classList.remove('hidden');
	                
	                if (window.TaxiShare?.toast) {
	                    TaxiShare.toast.show('1명의 매칭 결과를 찾았습니다!', 'success');
	                }

	                // Scroll to results
	                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
	            }, 2000);
	        }

	        // Enable/disable search button based on inputs
	        function updateSearchButton() {
	            const hasAllInputs = departureInput.value && destinationInput.value && departureTimeInput.value;
	            searchButton.disabled = !hasAllInputs || isSearching;
	        }

	        // Event listeners
	        document.addEventListener('DOMContentLoaded', () => {
	            searchForm.addEventListener('submit', handleSearch);
	            
	            departureInput.addEventListener('input', updateSearchButton);
	            destinationInput.addEventListener('input', updateSearchButton);
	            departureTimeInput.addEventListener('input', updateSearchButton);
	            
	            // Initial state
	            updateSearchButton();
	        });
	    </script>
	</body>
</html>
